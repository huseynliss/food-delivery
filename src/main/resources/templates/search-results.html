<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Search Results</title>
    <!--    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css}"-->
    <!--          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"-->
    <!--          rel="stylesheet"/>-->
    <link th:href="@{/assets/css/search-style.css}" rel="stylesheet"/>
    <link th:href="@{/assets/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top" style="background-color: #FFB30E">
    <div class="container">
        <a class="navbar-brand" href="#"><img class="d-inline-block" style="background-color: white; padding: 3px"
                                              src="/assets/img/gallery/logo.svg"
                                              alt="logo"/><span
                style="color: white; margin-left: 5px; font-weight: 700; font-size: x-large">FoodwaGon</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="http://localhost:8081/index" style="color: white; font-weight: 555; font-size: large">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8081/index/search-results" style="color: white; font-weight: 555; font-size: large">Order Food</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8081/about" style="color: white; font-weight: 555; font-size: large">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8081/contact" style="color: white; font-weight: 555; font-size: large">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white; font-weight: 555; font-size: large">Login</a>
                </li>
                <li class="nav-item basket" style="background-color:white">
                    <a class="nav-link" href="http://localhost:8081/index/add-to-cart" style="color: #FFB30E; font-weight: 555; font-size: large">
                        <i class="fas fa-shopping-cart"></i>
                        Cart <span>0</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8081/logout" style="color: white; font-weight: 555; font-size: large">Logout</a>
                </li>
                <li class="nav-item">
                    <span style="color: orange; background-color: white; padding: 10px 20px; border-radius: 10px; font-size: 20px; margin-left: 25px; font-weight: bold" th:if="${#request.remoteUser}" th:text="${#request.remoteUser}" />
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-white py-5" style="background-color: #FFB30E; height: 120px">
    <h1 class="text-center" style="color: white; padding-top: 10px">Search Products</h1>
</div>

<div class="col-6 mt-5" style="width: 75%; float: right">
    <input type="text" class="container form-control mb-5 p-3" style="width: 200px; margin-left: 220px"
           placeholder="Search Here..."
           id="search-input">
    <div style="margin-left: 23px" id="myBtnContainer">
        <button class="btnMain active" onclick="filterSelectionButton('')">Show all</button>
        <button class="btnMain" onclick="filterSelectionButton('burger')">Burgers</button>
        <button class="btnMain" onclick="filterSelectionButton('spaghetti')">Spaghetti</button>
        <button class="btnMain" onclick="filterSelectionButton('salad')">Salads</button>
        <button class="btnMain" onclick="filterSelectionButton('sushi')">Sushi</button>
        <button class="btnMain" onclick="filterSelectionButton('cake')">Cakes</button>
        <button class="btnMain" onclick="filterSelectionButton('soup')">Soups</button>
        <button class="btnMain" onclick="filterSelectionButton('pizza')">Pizzas</button>

    </div>
</div>
<div class="wrapper">
    <header>
        <h2>Price Range</h2>
        <p>Use slider or enter min and max price</p>
    </header>
    <div class="price-input">
        <div class="field">
            <span>Min</span>
            <input type="number" class="input-min" value="0">
        </div>
        <div class="separator">-</div>
        <div class="field">
            <span>Max</span>
            <input type="number" class="input-max" value="20">
        </div>
    </div>
    <div class="slider">
        <div class="progress"></div>
    </div>
    <div class="range-input">
        <input type="range" class="range-min" min="0" max="20" value="0" step="1">
        <input type="range" class="range-max" min="0" max="20" value="20" step="1">
    </div>
</div>
<div class="product-cards" style="width: 97%">
    <div class="card" th:each="product : ${allProducts}" style="border-radius: 20px; border: 3px solid #FFB30E">
        <img id="productImage"  th:if="${product.getImage()}"
             th:src="${product.getImage().startsWith('assets') ? '/' + product.getImage() : product.getImage()}"
             style="height:140px; border-radius: 10px"/>

        <div class="body">
            <h5 id="productName" th:text="${product.getName()}"
                style="font-family: Cambria; margin: 0px; font-weight: 700"/>
            <div>
                <img src="/assets/img/gallery/location.png" style="width: 15px; height: 18px; margin-bottom: 7px">
                <span id="productLocation" th:text="${product.getLocationEntity().getLocation() != null ? product.getLocationEntity().getLocation() : ''}" style="font-size: 17.5px; color: #FFB30E; font-family: Source Sans Pro"/>


            </div>
            <span id="productPrice" th:text="${product.getPrice() + product.getCurrency()}"
                  style="font-size: 18px; font-family: Source Sans Pro; font-weight: 800"/>
            <div style="padding-bottom: 5px">
                <button type="button" class="btn btn-outline-warning container add-to-cart">Add to Cart</button>
            </div>
        </div>
    </div>
</div>
<footer class="text-center text-white" style="background-color: #FFB30E; width: 100%">
    <!-- Grid container -->
    <div class="container p-4 pb-0">
        <!-- Section: CTA -->
        <section class="">
            <p class="d-flex justify-content-center align-items-center">
                <span class="me-3">Register for free</span>
                <a href="http://localhost:8081/register"><button type="button" class="btn btn-outline-light btn-rounded">
                    Sign up!
                </button></a>
            </p>
        </section>
        <!-- Section: CTA -->
    </div>
    <!-- Grid container -->

    <!-- Copyright -->
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        Â© 2020 Copyright:
        <a class="text-white" href="https://mdbootstrap.com/">MDBootstrap.com</a>
    </div>
    <!-- Copyright -->
</footer>
<!-- Footer -->


<script th:src="@{https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js}"></script>
<!--<script th:src="@{/assets/js/search.js}"></script>-->
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>

<!--<script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js}"></script>-->
<script th:inline="javascript">
    //Searching with PathVariable

    var productName = [[${productName}]];
    const listProducts = document.querySelectorAll("#productName");
    listProducts.forEach((item) => {
        if (productName != null) {
            if (item.textContent.toLowerCase().includes(productName.toLowerCase().toString())) {
                item.parentElement.parentElement.style.display = ""
            } else {
                item.parentElement.parentElement.style.display = "none"
            }
        }

    })

    //--------------------Add To Cart-------------------------------------------

    let products = [];
    let carts = document.querySelectorAll(".card");

    function removeDollarSign(value) {
        return parseFloat(value.replace("$", ""));
    }
    for (let i = 0; i < carts.length; i++) {;
        products.push({
            name: carts[i].querySelector("#productName").innerText,
            image: carts[i].querySelector("#productImage").getAttribute("src").slice(1),
            tag: "id" + Math.random().toString(16).slice(2),
            price: removeDollarSign(carts[i].querySelector("#productPrice").innerText),
            inCart: 0
        });
    }
    console.log(products)
    //-------------------------------------------------------------
    let addToCarts = document.querySelectorAll(".add-to-cart");

    for (let x = 0; x < addToCarts.length; x++) {
        addToCarts[x].addEventListener("click", () => {
            cartNumbers(products[x]);
            totalCost(products[x]);
        })
    }

    function onLoadCartNumbers() {
        let productNumbers = localStorage.getItem("cartNumbers");
        document.querySelector(".basket span").innerHTML=productNumbers;
    }


    function cartNumbers(product) {
        let productNumbers = localStorage.getItem("cartNumbers");

        productNumbers = parseInt(productNumbers);

        if (productNumbers) {
            localStorage.setItem("cartNumbers", (productNumbers + 1).toString());
            document.querySelector(".basket span").textContent = productNumbers + 1;
        } else {
            localStorage.setItem("cartNumbers", "1");
            document.querySelector(".basket span").textContent = 1;
        }
        setItems(product);
    }

    function setItems(product) {
        let cartItems = localStorage.getItem('productsInCart');
        cartItems = JSON.parse(cartItems);

        if (cartItems != null) {
            if (cartItems[product.tag] == undefined) {
                cartItems = {
                    ...cartItems,
                    [product.tag]: product
                }
            }
            cartItems[product.tag].inCart += 1;
        }else {
            product.inCart = 1;
            cartItems = {
                [product.tag]: product
            }
        }

        localStorage.setItem("productsInCart", JSON.stringify(cartItems));
    }

    let round;
    round = (number, decimalPlaces) => {
        const factorOfTen = Math.pow(10, decimalPlaces)
        return Math.round(number * factorOfTen) / factorOfTen
    };



    function totalCost(product) {
        let cartCost = localStorage.getItem("totalCost")

        if (cartCost != null) {
            cartCost = parseFloat(cartCost);
            localStorage.setItem("totalCost", round(cartCost + product.price, 2));
        } else {
            localStorage.setItem("totalCost", product.price);
        }
    }

    onLoadCartNumbers();

</script>
<script>
    // --------------------------------------Price Range------------------------------------------------------
    const rangeInput = document.querySelectorAll(".range-input input"),
        priceInput = document.querySelectorAll(".price-input input"),
        range = document.querySelector(".slider .progress");
    let priceGap = 1;

    priceInput.forEach((input) => {
        input.addEventListener("input", (e) => {
            let minPrice = parseFloat(priceInput[0].value),
                maxPrice = parseFloat(priceInput[1].value);

            if (maxPrice - minPrice >= priceGap && maxPrice <= rangeInput[1].max) {
                if (e.target.className === "input-min") {
                    rangeInput[0].value = minPrice;
                    range.style.left = (minPrice / rangeInput[0].max) * 100 + "%";
                } else {
                    rangeInput[1].value = maxPrice;
                    range.style.right = 100 - (maxPrice / rangeInput[1].max) * 100 + "%";
                }
            }
            const productsPriceList = document.querySelectorAll("#productPrice");
            productsPriceList.forEach((item) => {
                if (parseFloat(item.textContent) >= minPrice && parseFloat(item.textContent) <= maxPrice) {
                    item.parentElement.parentElement.style.display = ""
                } else {
                    item.parentElement.parentElement.style.display = "none"
                }
            })


        });
    });

    rangeInput.forEach((input) => {
        input.addEventListener("input", (e) => {
            let minVal = parseFloat(rangeInput[0].value),
                maxVal = parseFloat(rangeInput[1].value);

            if (maxVal - minVal < priceGap) {
                if (e.target.className === "range-min") {
                    rangeInput[0].value = maxVal - priceGap;
                } else {
                    rangeInput[1].value = minVal + priceGap;
                }
            } else {
                priceInput[0].value = minVal;
                priceInput[1].value = maxVal;
                range.style.left = (minVal / rangeInput[0].max) * 100 + "%";
                range.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
            }
            const productsPriceList = document.querySelectorAll("#productPrice");

            productsPriceList.forEach((item) => {
                if (parseFloat(item.textContent) >= minVal && parseFloat(item.textContent) <= maxVal) {
                    item.parentElement.parentElement.style.display = ""
                } else {
                    item.parentElement.parentElement.style.display = "none"
                }
            })
        });
    });
    //---------------------------------Filter With Input-------------------

    document.querySelector('#search-input').addEventListener('input', filterList);

    function filterList() {
        const allProducts = document.querySelectorAll('.card');
        allProducts.forEach((item) => {
            item.style.display = 'none'
        })

        const searchInput = document.querySelector('#search-input');
        const filter = searchInput.value.toLowerCase();
        const nameListItems = document.querySelectorAll('#productName');
        const locationListItems = document.querySelectorAll('#productLocation');

        for (let i = 0; i < nameListItems.length || i < locationListItems.length; i++){
            if (nameListItems[i].textContent.toLowerCase().includes(filter.toLowerCase())){
                nameListItems[i].parentElement.parentElement.style.display = "";
            }
            if (locationListItems[i].textContent.toLowerCase().includes(filter.toLowerCase())){
                locationListItems[i].parentElement.parentElement.parentElement.style.display = "";
            }
        }
    }
    //---------------------------------Filter With Button-------------------
    function filterSelectionButton(name){

        const nameListItems = document.querySelectorAll('#productName');

        nameListItems.forEach((item) => {
                if (item.textContent.toLowerCase().includes(name.toString().toLowerCase())) {
                    item.parentElement.parentElement.style.display = ""
                } else {
                    item.parentElement.parentElement.style.display = "none"
                }
            }
        )}

    const btnContainer = document.getElementById("myBtnContainer");
    const btns = btnContainer.getElementsByClassName("btnMain");
    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener("click", function() {
            var current = document.querySelectorAll(".active");
            current.forEach(item => item.className=item.className.replace(" active", ""))
            this.className += " active";
        });
    }
</script>
</body>

</html>